---
title: "DATATHON Final Project: Impact of historical greenhouse emissions on fish response: United States, a case study"
author: "Lesly"
date: "2024-12-17"
output: html_document
---

# Introduction


-   **Objective**: Analyze the relationship between historical emissions of CO₂, CH₄, and N₂O and fish response to climate change using publicly available datasets.
-   **Research Question**: How do historical greenhouse gas emissions (standardized to CO₂ equivalents) influence fish responses in the United States?


# Methodology
In order to conduct the analysis, the following R libraries were used:

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(dplyr)
library(rstatix)
library(knitr)
library(gganimate)
```


## Load data
### Emissions from 1830 to 2023
```{r}
emissions_data <- read_excel("USA Emissions.xlsx")
head(emissions_data)
```


## Fish data
```{r}
fish_data <- read_csv("database (3).csv")
head(fish_data)
colnames(fish_data)
```



## Standardize Units, convert CH4 and N2O to CO2 equivalents
## Using global warming potentials (GWP): CH4 = 25, N2O = 298
### Standardize Units
### Convert greenhouse gases to CO2 equivalents
### GWP (Global Warming Potential): CH4 = 25, N2O = 298

```{r}
emissions_data <- emissions_data %>%
  mutate(
    CH4_in_CO2eq = if_else(Gas == "CH[4]", Data * 25, 0), # Convert CH4 to CO2 equivalents
    N2O_in_CO2eq = if_else(Gas == "N[2]*O", Data * 298, 0), # Convert N2O to CO2 equivalents
    CO2_in_CO2eq = if_else(Gas == "CO[2]", Data * 1000, 0), # Convert CO2 from Pg to Tg
    Total_CO2eq = CH4_in_CO2eq + N2O_in_CO2eq + CO2_in_CO2eq # Sum of all gases in CO2eq
  ) %>%
  group_by(Year) %>%
  summarize(Total_CO2eq = sum(Total_CO2eq, na.rm = TRUE)) # Aggregate by year
head(emissions_data)
```

## Merge dataset
```{r}
merged_data <- fish_data %>%
  mutate(Fish_Response = as.factor(Fish_Response)) %>%
  inner_join(emissions_data, by = "Year")
```


## Data exploration
## Summary for emissions
```{r}
summary(emissions_data)
```


### Summary for fish response
```{r}
fish_data %>% count(Fish_Response)
```





### Animation: Emissions Over Time
```{r}
ggplot(emissions_data, aes(x = Year, y = Total_CO2eq)) +
  geom_line(color = "blue") +
  labs(
    title = "Animated Emissions Over Time",
    x = "Year",
    y = "Total CO2eq (Tg/year)"
  ) +
  transition_reveal(Year) +
  theme_minimal()
```



## Statistical Analysis
### Model Relationship Between Emissions and Fish Response
### Logistic regression to analyze relationship
```{r}
model <- glm(Fish_Response ~ Total_CO2eq, 
             data = merged_data, 
             family = "binomial")
summary(model)
```


# Results 
- **Visualization**: The time series of emissions shows trends in CO₂-equivalent emissions over time.
### Visualize Emissions Over Time
```{r}
ggplot(emissions_data, aes(x = Year)) +
  geom_line(aes(y = Total_CO2eq, color = "Total CO2eq (Tg/year)")) +
  labs(
    title = "Historical USA Emissions in CO2 Equivalents",
    x = "Year",
    y = "Emissions (Tg CO2eq/year)",
    color = "Greenhouse gas"
  ) +
  theme_minimal()
```

- **Fish Response**: The categorical distribution of fish responses suggests potential patterns in relation to emissions.
### Visualization: Fish Response Distribution
```{r}
ggplot(fish_data, aes(x = Fish_Response)) +
  geom_bar(fill = "steelblue") +
  labs(
    title = "Distribution of Fish Response Categories",
    x = "Fish Response Category",
    y = "Count"
  ) +
  theme_minimal()
```


- **Statistical Model**: The logistic regression model indicates significant relationships between total CO₂-equivalent emissions and fish response (details in summary table).

### Visualize the relationship
```{r}
ggplot(merged_data, aes(x = Total_CO2eq, y = Fish_Response)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.6) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), color = "blue") +
  labs(
    title = "Relationship Between Total CO2eq and Fish Response",
    x = "Total CO2eq (Tg/year)",
    y = "Fish Response (log-odds)"
  ) +
  theme_minimal()
```






# Discussion
- **Findings**:
  - Total CO₂-equivalent emissions are significantly correlated with changes in fish responses.
  - Increasing emissions are associated with more negative fish response categories.
- **Limitations**:
  - Potential biases in the fish response dataset.
  - Lack of control variables (e.g., temperature).




# Conclusions
- This study highlights the impact of historical greenhouse gas emissions (in CO₂ equivalents) on fish response.
- Future work should include additional ecological variables for a more comprehensive analysis.



-   **References**:
1. Jones, M. W., Peters, G. P., Gasser, T., Andrew, R. M., Schwingshackl, C., Gütschow, J., Houghton, R. A., Friedlingstein, P., Pongratz, J., & Quéré, C. L. (2023). National contributions to climate change due to historical emissions of carbon dioxide, methane, and nitrous oxide since 1850. Scientific Data, 10(1). https://doi.org/10.1038/s41597-023-02041-1

2. Krabbenhoft, T. J., Myers, B. J. E., Wong, J. P., Chu, C., Tingley, R. W., Falke, J. A., Kwak, T. J., Paukert, C. P., & Lynch, A. J. (2020). FiCli, the Fish and Climate Change Database, informs climate adaptation and management for freshwater fishes. Scientific Data, 7(1). https://doi.org/10.1038/s41597-020-0465-z

    
    
    
```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
